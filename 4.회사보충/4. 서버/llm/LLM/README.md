# GAON

- 계약연구센터(가온플랫폼, 고려대)에서는 SaaS LLM(Software-as-a-Service based on Large Language Models)이나 LLM 납품에 필요한 LLM 원천기술 연구를 목표
- GAON-LLM은 [Gemma-ko](https://huggingface.co/beomi/gemma-ko-7b)를 백본으로 개발된 한국어 대규모 언어 모델이며, [기술과학 문서 기계독해 데이터](https://www.aihub.or.kr/aihubdata/data/view.do?currMenu=&topMenu=&aihubDataSe=ty&dataSetSn=71533)  및 [dolly-ko](https://huggingface.co/datasets/nlpai-lab/databricks-dolly-15k-ko)를 활용하여 한국어 기술과학 문서 QA 성능 향상

</div>


## Finetune

```shell
# 1
pip install -r requirements.txt

# 2
. run.sh 2>&1 > log 
```




## Quick start

```python
from transformers import AutoTokenizer, pipeline
import torch

model_and_tokenizer_path = "{model_path}"
tokenizer = AutoTokenizer.from_pretrained(model_and_tokenizer_path)

pipeline = pipeline(
    "text-generation",
    model=model_and_tokenizer_path,
    tokenizer=tokenizer,
    model_kwargs={"torch_dtype": "auto"},
    device="cuda:0",
)


#chat_template
# messages = [
#     {"role": "user", 
#      "content": "이순신 장군이 누구야?"},
# ]
# prompt = tokenizer.apply_chat_template(messages, tokenize=False, add_generation_prompt=True) # Don't use `pipeline.tokenizer`


#W/O chat_template
prompt='이순신 장군이 누구야?'

outputs = pipeline(
    prompt,
    max_new_tokens=1028,
    add_special_tokens=True
)

print(outputs[0]["generated_text"][len(prompt):]) # '이순신 장군은 조선 시대의 장군으로 임진왜란 당시 조선의 수군을 이끌고 일본의 공격으로부터 보호한 인물입니다.마침내 이순신 장군은 1592년에 조선 수군을 이끌고 일본의 공격으로부터 보호하는 데 성공했습니다.'
```











## GAON-LLM 추론 결과 예시
#### klue-mrc 
```json
[
    {
        "query": "수출입이나 생산, 투자 활동은 여러가지 형태로 규제되고 있다. 비록 싸게 생산할 수 있었다고 해도, 그것을 싸게 국내에 팔 수 있다고는 할 수 없다.\n; 관세\n: 국가가 수입품에 관세를 부과하는 것에 의해서, 국외의 상품의 유입을 억제해, 국내산업을 보호할 수 있다. 단 고율의 관세는 자유 무역이나 WTO의 생각에 반하는 것이다.\n; 수입에 대한 규제\n: 안전이나 환경, 혹은 덤핑 등의 이유에 의해, 수입이 규제되는 경우가 있다. 농산물의 수입에 관한 농약에 대한 규제나, 우해면상뇌증 (BSE)에 관한 규제, 혹은 수은 등의 유해한 금속을 이용한 제품의 수입규제 등. 또, 급격한 수입품의 증가에 대해서, 세이프가드가 발동되는 경우도 있다.\n; 국제법·국제기관에 의한 규제\n: 가혹한 노동이나 환경 파괴 등에, 각종 조약 등에 의해 국제적으로 규제가 이루어지고 있다. 예를 들면, 경제적 착취라고 볼 수 있는 아동노동은 아동의 권리에 관한 협약에 의해서 금지되고 있어 노동 조건이나 생활수준의 개선을 목적으로 한 ILO가 설치되어 있다.\n: 이러한 국제적 기준에 의한 규제는 바닥으로의 경쟁을 억제하지만, 원칙으로서 해당 국가의 동의가 없으면 국제법에 의한 규제는 미치지 않는다. 또, 무엇을 가지고 국제기준으로 할지에 임해서 각국의 이해대립이 있어, 예를 들면 미국의 기준이 강요하고 있다고 하여, 미국화 등으로 비판되고 있다.\n해당 지문을 보고 질문에 대한 정답을 찾아요.\n고율의 관세를 국제법으로 규정하고 있는 단체는?",
        "response": {
        "gold": "WTO",
        "generation": "고율의 관세를 국제법으로 규정하고 있는 단체는 WTO입니다. 이는 세계무역기구(World Trade Organization)의 약자로, 국제무역을 원활하게 하기 위해 설립된 기구입니다. WTO는 고율의 관세가 자유무역과 세계무역의 원칙에 위배되는 것으로 보고 있으며, 이를 금지하고 있습니다."
            }
    },
    {
        "query": "대우조선해양은 그리스 안젤리쿠시스그룹 산하 마란 탱커스사로부터 초대형 원유운반선 2척을 수주했다고 18일 밝혔다. 이들 원유운반선은 31만9000t급으로 길이 336m, 너비 60m 규모다. 수주 금액은 척당 9500만달러 안팎이다. 두 선박은 거제 옥포조선소에서 고효율 엔진과 연료절감 기술을 적용한 차세대 친환경 선박으로 건조돼 2017년 내에 인도될 예정이다.안젤리쿠시스그룹은 1994년 첫 거래 이후 이번 계약까지 총 84척의 선박을 대우조선에 발주했다. 현재 총 25척의 안젤리쿠시스그룹 선박이 거제 옥포조선소와 루마니아 조선소에서 건조되고 있다. 정성립 대우조선 사장은 “회사가 어려운 환경에 놓여 있지만 고객사의 신뢰는 여전히 굳건하다”며 “세계 최고의 기술력을 토대로 높은 품질의 선박을 건조해 신뢰에 보답하겠다”고 말했다.유동성 측면에서 어려움을 겪은 대우조선은 채권단의 지원방안 발표 이후 경영 정상화에 박차를 가하고 있다. 지난 16일에는 전체 구성원이 회사가 나아갈 방향을 모색하는 ‘합동 대토론회’를 여는 등 경영상황을 개선하기 위해 노사가 힘을 모으고 있다. 대우조선은 이번 계약을 포함해 올해 총 45억달러 상당의 선박을 수주했다.\n주어진 내용을 바탕으로 정답을 찾아서 작성해줘.\n안젤리쿠시스그룹이 대우조선과의 첫 거래에서 주문한 선박은 몇 척인가?",
        "response": {
        "gold": "84척",
        "generation": "안젤리쿠시스그룹은 첫 거래에서 84척의 선박을 대우조선에 주문했습니다."
            }
    }
]
```

#### GAON test

```json
[ 
    {
        "query": "다음과 같은 문맥이 주어졌을 때\n가동전시험(PST) : 기기 설치 후부터 노심열에 의한 최초 전력생산 이전까지의 기간 또는 가동중 원전에서 기기 가동전 기간에 수행하는 시험\n가동전시험 기간 : 기기 설치 후부터 노심열에 의한 최초 전력생산 이전까지의 기기 및 계통시험을 수행하는 기간 또는 가동중 원전에서 기기 최초 가동전 기간\n가동중시험(1ST) : 노심열에 의한 최초 전력생산 이후에 기기，구조물，계통의 안전기능 수행능력을 점검하기 위한 시험\n감시(monitoring) : 계통，구조물 또는 기기의 특성을 파악하거나 성능을 확인하기 위하여，연속적 또는 주기적 관찰이나 측정\n개조(modification) : 계통，구조물 또는 기기의 설계변경\n경향분석 : 동일장치의 유사한 조건에서 얻어진 이전자료와 현재 자료를 비교하는 것\n계측기 루프 : 둘 이상의 계측기 또는 기기가 함께 사용되어 하나의 출력을 내는 것으로 예를 들면 진동 탐촉자와 관련 신호조절기 및 판독장치\n계측기 루프 정밀도 : 계측기 루프의 정밀도는 단독으로 고려한 루프내의 각 계기 또는 기기의 오차제곱의 합에 대한 제곱근에 근거하며，계측기 루프의 허용 부정확도는 계측기 루프에 일정한 입력을 주었을 때 나오는 출력에 근거하기도 함\n계통저항 : 유동에 대한 수력학적인 저항\n과압보호(overpressure protection) : KETIC-MN의 요건에 따라 다른 설계규정 또는 압력방출장치를 사용하여 기기가 과압되는 것을 방지하는 수단\n기준값 : 기기가 정상적으로 운전될 때 측정 또는 결정된 하나 이상의 변수값\n기준점 : 기준값을 설정하고，허용기준과 비교하기 위하여 가동중시험 변수를 측정하는 운전점\n능동밸브(active valves) : 밀폐장치가 동작하여 안전기능을 수행하는 밸브\n동작(시험)(exercising) : 직접 감시 또는 간접 위치표시에 의한 기기 구동부 기능 확인시험\n밀폐장치(obturator) : 밸브의 폐쇄 구성품(disk, gate, plug, ball 등)\n방진기 : 기기 또는 계통에 급격하게 전달되는 하중에 의한 변위를 구속하지만 열에 의한 변위는 자유롭게 허용해 주는 기기\n발전사업자(owner) : 해당 규제기관에 건설허가 또는 운영허가를 신청하였거나 허가를 득한 원전의 운전，유지，안전，발전을 법적으로 책임지는 조직\n발전소 운전(plant operation) : 발전소 기술지침서에 의하여 정의된 기동，출력운전，고온 대기，원자로 냉각 등의 발전소 상태\n비해체시험(nonintrusive Testing) : 기기를 분해하거나，경계에 영향을 미치지 않고，수행하는 시험\n성능시험 : 계통 또는 기기가 정해진 허용기준을 만족하는지를 결정하기 위한 시험\n피동밸브(passive valves) : 밀폐장치가 움직이지 않는 상태에서 안전기능을 수행하는 밸브\n수리 : 열화된 품목을 원 설계 요건대로 복구하는 과정\n\n\nMOA（2015 년 판）\n스키드(skid) 장착 펌프 및 밸브 : 주요기기에 부착되었거나，스키드에 직접 장착되지 않았어도 주요 기기의 운전을 보조하는 펌프 및 밸브. 일반적으로 이 펌프 및 밸브는 주요기기 제작자가 공급하며\n예를 들면，\n(1) 스키드 장착 디젤 연료펌프 및 밸브，\n(2) 보조급수 터빈펌프의 증기유입 및 트립용 교축밸브，\n(3) 공기압구동 밸브를 조절하기 위한 솔레노이드 밸브 등.\n안전기능 수행능력 : 필요시 기기가 안전기능을 수행할 수 있는 능력\n유지보수 : 품목의 설계(외형 및 재질)를 변경하지 않는 부품교환，조정 및 유사한 조치\n일상정비 : 계획，예방정비의 수행 (예: 왕복 펌프의 밸브교체 또는 조정，오일교환，냉각계통 세정，패킹조정，패킹링 보충，메커니컬 실 보수 또는 교체)\n점검 : 발전사업자가 정한 요건에 적합한지를 결정하기 위한 관찰，육안감시 또는 측정\n정량적 시험 : 변수가 정해진 범위 안에 있는지를 확인하기 위하여 필요한 변수의 제한치 또는 구체적인 계량을 설정하기 위하여 수행하는 시험\n정성적 시험 : 변수의 구체적인 계량의 결정 없이 변수를 설정하기 위하여 수행하는 시험\n펌프 : 유체를 이송하는 기계장치\n2000년 이후 발전소 : 2000년 1월 1일 또는 그 이후 규제기관으로부터 건설허가를 받은 원자력발전소\n2000년 이전 발전소 : 2000년 1월 1일 이전 규제기관으로부터 건설허가 또는 운영허가를 받은 원자력발전소\n다음 질문에 답하세요:\n감시(monitoring)가 뭐야?",
        "response": {
        "gold": "계통，구조물 또는 기기의 특성을 파악하거나 성능을 확인하기 위하여，연속적 또는 주기적 관찰이나 측정입니다",
        "gpt4": "감시(monitoring)는 계통, 구조물 또는 기기의 특성을 이해하거나 그 성능을 확인하기 위해 연속적이거나 주기적으로 관찰하거나 측정하는 과정입니다. 이는 해당 장비나 시스템이 제대로 작동하는지, 예상대로 기능하는지를 확인하기 위한 중요한 절차로, 안전성 확보 및 효율적인 운영을 위해 필수적입니다.",
        "generation": "감시(monitoring)는 계통, 구조물 또는 기기의 특성을 파악하거나 성능을 확인하기 위하여 연속적 또는 주기적 관찰이나 측정을 의미합니다. 이 과정을 통해 기기의 정상적인 운전 상태, 구조적 특성, 그리고 성능 지표 등을 파악할 수 있습니다. 감시는 기기의 안전성을 유지하고, 필요 시 적절한 조치를 취하기 위해 필수적인 과정입니다."
            }
    },
    {
    "query": "내용: MOB 3530 필요한 유량이 부족한 펌프\n필요한 유량이 부족상태에 있는 B군 펌프(예: 건조한 집수조의 펌프)는 MOB 3520에 해당되는\n펌프를 제외하고 적어도 2년에 한번씩은 종합시험을 하여야 한다. 이 시험동안 필요한 유량을 공급\n하여야 하며，B군 시험은 하지 않아도 된다.\n\n질문: 필요한 유량이 부족한 펌프는 어떻게 시험해?",
    "response": {
        "gold": "필요한 유량이 부족상태에 있는 B군 펌프(예: 건조한 집수조의 펌프)는 MOB 3520에 해당되는\n펌프를 제외하고 적어도 2년에 한번씩은 종합시험을 하여야 한다. 이 시험동안 필요한 유량을 공급\n하여야 하며，B군 시험은 하지 않아도 된다.",
        "gpt4": "필요한 유량이 부족한 펌프는 MOB 3520에 해당되는 펌프를 제외하고, 2년에 한 번씩 종합시험을 실시해야 합니다. 이 시험 동안에는 필요한 유량을 공급해야 하며, B군 시험은 실시하지 않아도 됩니다. 이는 유량이 부족한 상태에서도 펌프의 성능을 정기적으로 점검하고 유지하기 위한 조치입니다.",
        "generation": "필요한 유량이 부족한 펌프는 MOB 3520에 해당되는 펌프를 제외하고 적어도 2년에 한 번씩 종합시험을 하여야 합니다. 이 시험 동안 필요한 유량을 공급해야 하며, B군 시험은 하지 않아도 됩니다. 이는 펌프의 성능을 정기적으로 점검하고 유지 관리하기 위해 필요하며, 특히 건조한 집수조의 펌프와 같이 유량이 부족한 펌프의 경우, 이러한 점검을 통해 필요한 유량을 정확하게 공급할 수 있도록 합니다."
            }
    }
]
```
